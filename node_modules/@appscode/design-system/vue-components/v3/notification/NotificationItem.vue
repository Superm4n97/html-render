<script setup lang="ts">
import { computed, toRefs } from "vue";
import moment from "moment";
import type { Notification } from "../../types/notification";

interface Props {
  notification?: Notification;
}

const props = withDefaults(defineProps<Props>(), {
  notification: () => ({
    id: "0",
    status: "Pending",
    time: 0,
  }),
});

const getDayDifferences = (options: { past: number }) => {
  const past = moment(options.past).isValid() ? moment(options.past).valueOf() / 1000 : options.past;
  const now = Date.now() / 1000;
  const diff = now - past;
  if (options.past > 10) {
    let ret = Math.floor(diff / 86400);
    let unit = "";
    if (diff < 60) {
      ret = diff;
      unit = " Second";
    } else if (diff < 3600) {
      ret = diff / 60;
      unit = " Minute";
    } else if (diff < 86400) {
      ret = diff / 3600;
      unit = " Hour";
    } else {
      ret = diff / 86400;
      unit = " Day";
    }
    unit += ret > 1 ? "s" : "";
    return ret + unit;
  }
  return undefined;
};

const { notification } = toRefs(props);
const notificationTime = computed(() => getDayDifferences({ past: notification?.value?.time || 0 }));
</script>

<template>
  <a class="single-notification-item is-complete">
    <p>
      {{ notification.msg }}
    </p>
    <div class="notification-status">
      <p
        :class="{
          'is-success': notification.status === 'Success',
          'has-text-danger': notification.status === 'Failed',
          'is-info': notification.status === 'Started' || notification.status === 'Running',
          'is-warning': notification.status === 'Pending',
        }"
      >
        <i
          class="fa mr-5"
          :class="{
            'fa-check': notification.status === 'Success',
            'fa-exclamation-triangle': notification.status === 'Failed',
            'fa-info-circle':
              notification.status === 'Started' ||
              notification.status === 'Pending' ||
              notification.status === 'Running',
          }"
        />
        {{ notification.status }}
      </p>
      <p>{{ notificationTime }} ago</p>
    </div>
  </a>
</template>
