<script setup lang="ts">
import { defineAsyncComponent, ref } from "vue";

const ContentLayout = defineAsyncComponent(() => import("./ContentLayout.vue"));
const ContentHeader = defineAsyncComponent(() => import("./ContentHeader.vue"));
const HeaderItem = defineAsyncComponent(() => import("./../header/HeaderItem.vue"));
const SearchBar = defineAsyncComponent(() => import("./../searchbars/SearchBar.vue"));

interface Props {
  removeTableHeaderPadding?: boolean;
  tableTitle?: string;
  tableSubTitle?: string;
  searchable?: boolean;
  hideHeader?: boolean;
  removeBorderBottom?: boolean;
}

const props = withDefaults(defineProps<Props>(), {
  removeTableHeaderPadding: false,
  tableTitle: "Table",
  tableSubTitle: "",
  searchable: false,
  hideHeader: false,
  removeBorderBottom: false,
});

const emit = defineEmits(["onSearchTextChange"]);

const formattedTitle = props.tableTitle.trim()?.replace(/ /g, "-")?.toLowerCase();
const acInputId = `${formattedTitle}-search`;
const searchText = ref("");

const updateSearchText = (text: string) => {
  searchText.value = text;
  emit("onSearchTextChange", text);
};
</script>

<template>
  <content-layout>
    <template #content-header>
      <content-header
        v-if="!hideHeader"
        :header-title="tableTitle"
        :header-sub-title="tableSubTitle"
        :remove-border-bottom="removeBorderBottom"
        :class="{ 'pl-0 pr-0': removeTableHeaderPadding }"
      >
        <template #title-right-actions>
          <slot name="title-right-actions" />
        </template>
        <slot name="content-left-controls" />
        <header-item>
          <search-bar v-if="searchable" @search="updateSearchText" :ac-input-id="acInputId" />
        </header-item>
        <slot name="content-right-controls" />
      </content-header>
    </template>
    <slot name="content" :search-text="searchText" :update-search-text="updateSearchText" />
  </content-layout>
</template>
