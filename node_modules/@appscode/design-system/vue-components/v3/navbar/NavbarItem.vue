<script setup lang="ts">
import { useRoute } from "vue-router";
import { computed, ref, watch } from "vue";
import { onClickOutside } from "@vueuse/core";

interface Props {
  modifierClasses?: string;
}

withDefaults(defineProps<Props>(), {
  modifierClasses: "",
});

const emit = defineEmits(["onIsActiveChange", "onRouteChange"]);

const navbarItem = ref(null);

const isActive = ref("");
function clickEvent() {
  if (isActive.value) isActive.value = "";
  else isActive.value = "is-active";
  emit("onIsActiveChange", isActive.value);
}

const route = useRoute();
watch(
  () => route.fullPath,
  (n) => {
    isActive.value = "";
    emit("onRouteChange");
  }
);
onClickOutside(navbarItem, () => {
  isActive.value = "";
  emit("onIsActiveChange", isActive.value);
});

const isActiveClass = computed(() => (isActive.value.length ? ` ${isActive.value}` : ""));
</script>

<template>
  <div ref="navbarItem" class="ac-menu-item" :class="modifierClasses + isActiveClass">
    <button class="button ac-nav-button" @click="clickEvent()">
      <slot name="navbar-item" />
    </button>
    <slot name="navbar-content" />
  </div>
</template>
