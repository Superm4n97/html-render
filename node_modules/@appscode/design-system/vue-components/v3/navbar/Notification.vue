<script setup lang="ts">
import { defineAsyncComponent, ref } from "vue";
import TimeConvert from "../../plugins/time-convert";
import type { Notification } from "../../types/notification";
const NavbarItem = defineAsyncComponent(() => import("./NavbarItem.vue"));
const NavbarItemContent = defineAsyncComponent(() => import("./NavbarItemContent.vue"));
withDefaults(
  defineProps<{
    notifications?: Array<Notification>;
    unreadNotification?: number;
  }>(),
  {
    notifications: () => [],
    unreadNotification: 0,
  }
);
function notificationTime(time: number) {
  return TimeConvert.getDayDifferences({ past: time });
}

const showNotification = ref(false);
function handleIsActiveChange(isActive: string | any[]) {
  showNotification.value = !!isActive?.length;
}
</script>
<template>
  <navbar-item ref="notificationItem" @on-is-active-change="handleIsActiveChange">
    <template #navbar-item>
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g clip-path="url(#clip0_534_14009)">
          <path
            d="M9.15331 14C9.03611 14.2021 8.86787 14.3698 8.66546 14.4864C8.46305 14.603 8.23357 14.6643 7.99998 14.6643C7.76639 14.6643 7.53691 14.603 7.3345 14.4864C7.13208 14.3698 6.96385 14.2021 6.84665 14M14.6666 11.3334H1.33331C1.86375 11.3334 2.37245 11.1227 2.74753 10.7476C3.1226 10.3725 3.33331 9.86381 3.33331 9.33337V6.00004C3.33331 4.76236 3.82498 3.57538 4.70015 2.70021C5.57532 1.82504 6.7623 1.33337 7.99998 1.33337C9.23766 1.33337 10.4246 1.82504 11.2998 2.70021C12.175 3.57538 12.6666 4.76236 12.6666 6.00004V9.33337C12.6666 9.86381 12.8774 10.3725 13.2524 10.7476C13.6275 11.1227 14.1362 11.3334 14.6666 11.3334Z"
            stroke="#061B2D"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </g>
        <defs>
          <clipPath id="clip0_534_14009">
            <rect width="16" height="16" fill="white" />
          </clipPath>
        </defs>
      </svg>

      <span v-if="unreadNotification > 999" class="notification-count">999+</span>
      <span v-else-if="unreadNotification !== 0" class="notification-count">{{ unreadNotification }}</span>
    </template>

    <template #navbar-content>
      <navbar-item-content v-if="showNotification" class="navbar-dropdown-wrapper" style="width: 320px; right: -30px">
        <div class="dropdown-inner">
          <div class="notification-header">
            <h5>Notification</h5>
            <span>{{ notifications.length }}</span>
          </div>

          <div class="notification-body ac-scrollbar p-0">
            <a v-for="data in notifications" href="#" class="single-notification" :key="data.id">
              <!-- <span class="round-icon">Z</span> -->
              <div class="notification-content">
                <h6>{{ data.msg }}</h6>
                <p>{{ data.status }}</p>
              </div>
              <span>{{ notificationTime(data.time) }}</span>
            </a>

            <a v-if="!notifications.length" href="#" class="single-notification">
              <!-- <span class="round-icon">Y</span> -->
              <div class="notification-content">
                <h6>No New Notification</h6>
                <p></p>
              </div>
              <span> </span>
            </a>
          </div>
        </div>
      </navbar-item-content>
    </template>
  </navbar-item>
</template>

<style lang="scss" scoped>
@import "../../../vue-components/styles/components/navbar/notification";
</style>
