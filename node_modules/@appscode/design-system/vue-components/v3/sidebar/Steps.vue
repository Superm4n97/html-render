<script lang="ts" setup>
import FeCheck from "~icons/fe/check";
import type { Step } from "../../types/importFlow";

interface Props {
  steps?: Step[];
  activeStepIdentifier?: number;
  activeSubStepIdentifier?: number;
}

withDefaults(defineProps<Props>(), {
  steps: () => [],
  activeStepIdentifier: 1,
  activeSubStepIdentifier: 1,
});
</script>

<template>
  <li
    v-for="step in steps"
    :key="step.identifier"
    :class="{
      'is-hidden': !step.isVisible,
    }"
  >
    <strong
      :class="{
        'is-active': step.identifier <= activeStepIdentifier,
      }"
    >
      <span
        :class="{
          'step-count': true,
          'is-active': step.identifier <= activeStepIdentifier,
        }"
        >{{ step.identifier }}</span
      >
      <span class="label-text">{{ step.title }}</span>
    </strong>
    <ul
      :class="{
        'is-hidden': step.identifier !== activeStepIdentifier,
      }"
    >
      <li
        v-for="substep in step.substeps"
        :key="substep?.identifier"
        :class="{
          'is-hidden': !substep.isVisible,
          'is-active': substep.identifier < activeSubStepIdentifier,
        }"
      >
        <strong>
          <span class="step-count"><FeCheck /></span>
          <span
            :class="{
              'label-text': true,
              'has-text-weight-semibold': substep.identifier <= activeSubStepIdentifier,
            }"
            >{{ substep.title }}</span
          >
        </strong>
      </li>
    </ul>
  </li>
</template>

<style lang="scss" scoped>
ul {
  padding-left: 4px !important;
  position: relative;
  z-index: 1;
  &::after {
    position: absolute;
    content: "";
    left: 15px;
    top: -16px;
    width: 1px;
    height: 100%;
    /* colors/primary/40-primary */
    border: 1px dashed #186cb4;
    z-index: -1;
  }
  li {
    display: block;
    padding: 6px 0;
    cursor: pointer;
    strong {
      /* colors/white */
      color: $white-100;
      display: flex;
      align-items: center;

      .step-count {
        width: 32px;
        height: 32px;
        margin-right: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        background-color: $primary-20;
        border: 1px solid $primary-40;
        color: $primary-80;
        font-size: 16px;
        &.is-active {
          background-color: $ac-primary;
          color: $white-100;
          border: 1px solid $color-border;
        }
      }
    }

    ul {
      max-height: 100% !important;

      li {
        &.is-active {
          strong {
            .step-count {
              background-color: $ac-primary;
              color: $white-100;
              border: 1px solid $color-border;
            }
            .label-text {
              color: $white-100;
              font-weight: 500;
            }
          }
        }
        strong {
          .step-count {
            width: 22px;
            height: 22px;
            margin-right: 16px;
            background: $primary-20;
            color: $primary-80;
            border: 1px solid $primary-40;
            font-size: 14px;
          }

          .label-text {
            color: $primary-95;
            font-weight: 400;
          }
        }
      }
    }
  }
}
</style>
