<script setup lang="ts">
import { nextTick, watch, ref } from "vue";

interface Props {
  id?: string;
  title?: string;
  url?: string;
  isActive?: boolean;
  icon?: string;
}

const props = withDefaults(defineProps<Props>(), {
  id: "sidebar-id",
  title: "sidebar-title",
  url: "/",
  isActive: false,
  icon: "@/assets/images/icons/basic.svg",
});

const sidebarItem = ref<HTMLElement | null>(null);

watch(
  () => props.isActive,
  (n) => {
    if (n) {
      nextTick(() => {
        setTimeout(() => {
          const top = (sidebarItem.value && sidebarItem.value.getBoundingClientRect().top) || 0;
          // preventing scroll to options that are already visible
          if (top > window.innerHeight - 200) {
            // scroll to selected option item
            sidebarItem.value?.scrollIntoView({
              behavior: "smooth",
              block: "center",
            });
          }
        }, 300);
      });
    }
  },
  { immediate: true }
);
</script>

<template>
  <li ref="sidebarItem" data-testid="cluster-sidebar-item">
    <router-link :id="id" :title="title" :to="url" :class="{ 'is-active': isActive }">
      <span>
        <img :src="icon" alt="icon" />
      </span>
      <strong>{{ title }}</strong>
    </router-link>
  </li>
</template>
